<?php 		include 'function.php';	$totalProduk = count(query("SELECT * FROM produk"));	// Pagination (Perpindahan hal)  if (isset($_POST["jdp"])) {      $dataTampil = $_POST["jdp"];  }else{    $dataTampil = 10;  }  $jdp = (isset($_POST["jdp"])) ? $_POST["jdp"] : 10;  $jumlahdataperhal = $dataTampil;  $jumlahdata = count(query("SELECT * FROM produk"));  $jumlahhal = ceil($jumlahdata / $jumlahdataperhal);  $halaktif = (isset($_GET["hal"])) ? $_GET["hal"] : 1;  $awaldata = ($jumlahdataperhal * $halaktif) - $jumlahdataperhal;  if (isset($_POST['sort'])) {  	if ($_POST['sort'] == 1) {			$produk = mysqli_query($koneksi, "SELECT * FROM produk ORDER BY harga ASC LIMIT $awaldata,$jumlahdataperhal");  	}elseif($_POST['sort'] == 2) {			$produk = mysqli_query($koneksi, "SELECT * FROM produk ORDER BY harga DESC LIMIT $awaldata,$jumlahdataperhal");  	}elseif($_POST['sort'] == 3) {			$produk = mysqli_query($koneksi, "SELECT * FROM produk ORDER BY id DESC LIMIT $awaldata,$jumlahdataperhal");  	}elseif($_POST['sort'] == 4) {			$produk = mysqli_query($koneksi, "SELECT * FROM produk ORDER BY id ASC LIMIT $awaldata,$jumlahdataperhal");  	}  }else{		$produk = mysqli_query($koneksi, "SELECT * FROM produk ORDER BY RAND() LIMIT $awaldata,$jumlahdataperhal");  }  if (isset($_POST['masukkanKeranjang'])) {  	if (!isset($_SESSION['login'])) {  		header('Location: index.php?page=login');  		exit;  	}else{  		$id_produk = $_POST['id'];  		$id_pemesan = $_SESSION['userid'];  		$tanggal = date("Y-m-d");  		$jumlah = 1;  		$cekStok = mysqli_query($koneksi, "SELECT * FROM produk WHERE id=$id_produk");  		if ($row = mysqli_fetch_assoc($cekStok)) {  			$stok = $row['stok'];  		}  		if ($stok > 0) {  			$minStok = $stok - 1;  			$cekPesanan = mysqli_query($koneksi, "SELECT * FROM keranjang WHERE id_pemesan='$id_pemesan' AND id_produk='$id_produk' ");	  		if ($hasil = mysqli_fetch_assoc($cekPesanan)) {	  			$id_pesan = $hasil['id'];	  			$jumlahPesan = $hasil['jumlah']; 	  			$jumlah = $jumlahPesan + 1;	  			$keranjang = mysqli_query($koneksi,"UPDATE keranjang SET jumlah='$jumlah' WHERE id='$id_pesan' ");	  		}else{	  			$jumlah = 1;  				$keranjang= mysqli_query($koneksi,"INSERT INTO keranjang VALUES ('','$id_produk','$jumlah','$tanggal','$id_pemesan')");	  		}  			$updateStok = mysqli_query($koneksi, "UPDATE produk SET stok='$minStok' WHERE id=$id_produk; ");			  echo "<meta http-equiv='refresh' content='0'>";  		}else{  			echo '<script>';			  echo 'alert("Mohon maaf, stok untuk produk ini telah habis !")';  //not showing an alert box.			  echo '</script>';			  echo "<meta http-equiv='refresh' content='0'>";  		}  	}  } ?><!-- BREADCRUMB --><div id="breadcrumb" class="section">	<!-- container -->	<div class="container">		<!-- row -->		<div class="row">			<div class="col-md-12">				<ul class="breadcrumb-tree">					<li><a href="index.php">Beranda</a></li>					<li class="active">Produk (<?php echo $totalProduk; ?> hasil)</li>				</ul>			</div>		</div>		<!-- /row -->	</div>	<!-- /container --></div><!-- /BREADCRUMB --><!-- SECTION --><div class="section">	<!-- container -->	<div class="container">		<!-- row -->		<div class="row">			<!-- STORE -->			<div id="store" class="col-md-12">				<!-- store top filter -->				<div class="store-filter clearfix">					<div class="store-sort">						<label>							Sort By : 							<form method="POST" action="">							<select class="input-select" name="sort" onchange="this.form.submit()">								<option value="">--- Pilih jenis pengurutan ---</option>								<option value="1">Harga terendah ke harga tertinggi</option>								<option value="2">Harga tertinggi ke harga terendah</option>								<option value="3">Produk baru ke produk lama</option>								<option value="4">Produk lama ke produk baru</option>							</select>							</form>						</label>						<label>							Show :							<form action="" method="POST">							<select class="input-select" name="jdp" onchange="this.form.submit()">								<?php if($_POST['jdp'] == 10) : ?>									<option value="10">10</option>									<option value="20">20</option>									<option value="30">30</option>									<option value="50">50</option>									<option value="100">100</option>								<?php elseif($_POST['jdp'] == 20 ) : ?>									<option value="20">20</option>									<option value="30">30</option>									<option value="50">50</option>									<option value="100">100</option>									<option value="10">10</option>								<?php elseif($_POST['jdp'] == 30 ) : ?>									<option value="30">30</option>									<option value="50">50</option>									<option value="100">100</option>									<option value="10">10</option>									<option value="20">20</option>								<?php elseif($_POST['jdp'] == 50 ) : ?>									<option value="50">50</option>									<option value="100">100</option>									<option value="10">10</option>									<option value="20">20</option>									<option value="30">30</option>								<?php elseif($_POST['jdp'] == 100 ) : ?>									<option value="100">100</option>									<option value="10">10</option>									<option value="20">20</option>									<option value="30">30</option>									<option value="50">50</option>								<?php else : ?>									<option value="10">10</option>									<option value="20">20</option>									<option value="30">30</option>									<option value="50">50</option>									<option value="100">100</option>								<?php endif; ?>							</select>							</form>						</label>					</div>					<span class="f14" style="margin-top: 30px;">Menampilkan <?php echo $jdp; ?> dari <?php echo $totalProduk; ?> produk</span>					<form action="" method="post" class="pull-right mt-4" style="min-width: 300px;">						<div class="form-group">							<input type="text" name="keyword1" id="keyword1" placeholder="Cari Produk ..." class="form-control f13">							<button type="submit" name="cariProduk1" id="cariProduk1">Cari</button>						</div>					</form>				</div>				<!-- /store top filter -->				<!-- store products -->				<div class="row" id="dataProduk1">					<!-- product -->					<?php while($row = mysqli_fetch_assoc($produk)) : ?>					<div class="col-md-3 col-xs-4">						<div class="product">							<div class="product-img">								<img src="img/produk/<?php echo $row['foto']; ?>">								<div class="product-label">									<span class="sale"><?php echo $row['brand']; ?></span>								</div>							</div>							<div class="product-body">								<p class="product-category"><?php echo $row['kategori']; ?></p>								<h3 class="product-name"><a href="index.php?page=detail&&id=<?php echo $row['id']; ?>"><?php echo $row['nama']; ?></a></h3>								<h4 class="product-price"><?php echo rupiah($row['harga']); ?></h4>							</div>							<div class="add-to-cart">								<form action="" method="post">									<input type="hidden" name="id" value="<?php echo $row['id']; ?>">									<button type="submit" name="masukkanKeranjang" class="add-to-cart-btn f12"><i class="fa fa-shopping-cart"></i> Tambah ke keranjang</button>								</form>							</div>						</div>					</div>					<?php endwhile; ?>					<!-- /product -->				</div>				<!-- /store products -->				<!-- store bottom filter -->				<div class="store-filter clearfix">					<ul class="store-pagination d-flex">              <?php if($halaktif > 1 ) : ?>                <li>                   <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $halaktif - 1; ?>">                     &laquo;                   </a>                </li>               <?php endif; ?>              <!-- Pilihan hal -->              <?php if ($halaktif == 1): ?>                <?php for($i = max(1, $halaktif - 2); $i <= min($halaktif + 4, $jumlahhal); $i++ ) : ?>                   <?php if($i == $halaktif ) : ?>                    <li class="active">                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>" class="text-white">                        <?= $i; ?>                      </a>                    </li>                  <?php else : ?>                    <li>                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>">                        <?= $i; ?>                      </a>                    </li>                  <?php endif; ?>                <?php endfor; ?>               <?php elseif ($halaktif == 2): ?>                <?php for($i = max(1, $halaktif - 2); $i <= min($halaktif + 3, $jumlahhal); $i++ ) : ?>                   <?php if($i == $halaktif ) : ?>                    <li class="active">                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>" class="text-white">                        <?= $i; ?>                      </a>                    </li>                  <?php else : ?>                    <li>                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>">                        <?= $i; ?>                      </a>                    </li>                  <?php endif; ?>                <?php endfor; ?>              <?php elseif ($halaktif == $jumlahhal): ?>                <?php for($i = max(1, $halaktif - 4); $i <= min($halaktif + 3, $jumlahhal); $i++ ) : ?>                   <?php if($i == $halaktif ) : ?>                    <li class="active">                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>" class="text-white">                        <?= $i; ?>                      </a>                    </li>                  <?php else : ?>                    <li>                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>">                        <?= $i; ?>                      </a>                    </li>                  <?php endif; ?>                <?php endfor; ?>               <?php elseif ($halaktif == ($jumlahhal - 1)) : ?>                <?php for($i = max(1, $halaktif - 3); $i <= min($halaktif + 3, $jumlahhal); $i++ ) : ?>                   <?php if($i == $halaktif ) : ?>                    <li class="active">                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>" class="text-white">                        <?= $i; ?>                      </a>                    </li>                  <?php else : ?>                    <li>                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>">                        <?= $i; ?>                      </a>                    </li>                  <?php endif; ?>                <?php endfor; ?>              <?php else: ?>                <?php for($i = max(1, $halaktif - 2); $i <= min($halaktif + 2, $jumlahhal); $i++ ) : ?>                   <?php if($i == $halaktif ) : ?>                    <li class="active">                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>" class="text-white">                        <?= $i; ?>                      </a>                    </li>                  <?php else : ?>                    <li>                      <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $i; ?>">                        <?= $i; ?>                      </a>                    </li>                  <?php endif; ?>                <?php endfor; ?>              <?php endif; ?>              <!-- Akhir pilihan hal -->              <!-- navigasi maju -->               <?php if($halaktif < $jumlahhal ) : ?>                <li>                   <a href="?page=produk&&jdp=<?= $jdp; ?>&&hal=<?= $halaktif + 1; ?> ">                     &raquo;                   </a>                </li>               <?php endif; ?>					</ul>				</div>				<!-- /store bottom filter -->			</div>			<!-- /STORE -->		</div>		<!-- /row -->	</div>	<!-- /container --></div><!-- /SECTION -->